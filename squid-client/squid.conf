############################################
# CLIENT SQUID CONFIGURATION (VM SIDE)
############################################

http_port 3128
visible_hostname client-squid

# ACL: networks allowed to use this proxy
acl localnet src 10.0.0.0/8
acl localhost src 127.0.0.1/32

http_access allow localhost
http_access allow localnet
http_access deny all

############################################
# DOMAINS TO ROUTE THROUGH PARENT SQUID
############################################
# Add all domains you want to force via parent
acl via_parent_domains dstdomain .example.com .mycorp.com .secureapp.net .ifconfig.me

############################################
# DEFINE PARENT SQUID
############################################
# Format: cache_peer <IP> parent <port> <icp-port> [options]
cache_peer 10.0.0.2 parent 3128 0 no-query default

############################################
# SEND ONLY THESE DOMAINS TO PARENT
############################################
cache_peer_access 10.0.0.2 allow via_parent_domains
cache_peer_access 10.0.0.2 deny all

# Never connect directly for those domains
never_direct allow via_parent_domains
# Everything else can go direct
never_direct deny all

############################################
# PORT RULES
############################################
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl Safe_ports port 21

# HTTPS CONNECT
acl CONNECT method CONNECT

http_access allow CONNECT !Safe_ports
http_access deny !Safe_ports

############################################
# LOGGING
############################################
access_log /var/log/squid/access.log squid

############################################
# PERFORMANCE TUNING
############################################
cache_mem 256 MB
maximum_object_size_in_memory 512 KB
maximum_object_size 20 MB
